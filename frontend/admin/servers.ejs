<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin servers | <%= name %></title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen text-white relative flex flex-col">

  <!-- Background gradients -->
  <div class="fixed inset-0 flex flex-col -z-10">
    <div class="h-1/2 bg-gradient-to-b from-[#0a0a0a] to-[#1a1a1a]"></div>
    <div class="h-1/2 bg-gradient-to-b from-[#242424] to-[#1a1a1a]"></div>
  </div>

  <!-- Navbar -->
  <%- include('../components/nav.ejs') %>

  <div class="flex flex-1 relative z-10">
    <%- include('../components/sidebar.ejs') %>

    <!-- Main content -->
    <main class="flex-1 p-6 space-y-8">

      <!-- servers Table -->
<section>
  <div class="flex items-center justify-between mb-4">
    <h2 class="text-2xl font-semibold text-gray-200 tracking-wide">VPS Instances</h2>
    <button onclick="openCNModal()" 
       class="bg-blue-600 hover:bg-blue-500 transition px-4 py-2 rounded-xl text-white font-medium shadow-lg">
      + Create server
  </button>
  </div>

  <div class="overflow-x-auto rounded-2xl shadow-lg border border-[#2a2a2a]">
    <table class="min-w-full bg-gradient-to-b from-[#1a1a1a] to-[#111111] rounded-2xl overflow-hidden">
      <thead>
        <tr class="bg-[#222222] text-left text-gray-300 text-sm uppercase tracking-wide">
          <th class="px-6 py-3">VPS Name</th>
          <th class="px-6 py-3">SSH</th>
          <th class="px-6 py-3">ContainerId</th>
          <th class="px-6 py-3">Created At</th>
          <th class="px-6 py-3">VPS Owner</th>
        </tr>
      </thead>
      <tbody>
        <% if (servers && servers.length > 0) { %>
          <% servers.forEach((server, index) => { %>
            <tr class="transition hover:bg-[#2c2c2c] <%= index % 2 === 0 ? 'bg-[#1a1a1a]' : 'bg-[#181818]' %>">
              <td class="px-6 py-3 font-medium text-gray-200"><%= server.name || "Unnamed server" %></td>
              <td class="px-6 py-3 text-gray-300">
  <%= (server.ssh ? server.ssh.replace(/^ssh session:\s*/i, '') : "N/A") %>
</td>
<td class="px-6 py-3 text-gray-300">
  <%= (server.containerId ? server.containerId.substring(0, 12) : "N/A") %>
</td>

              <td class="px-6 py-3 text-gray-300"><%= server.createdAt || "Unknown" %></td>
              <td class="px-6 py-3 text-gray-300"><%= server.user || "Unknown" %></td>
            
            </tr>
          <% }) %>
        <% } else { %>
          <tr>
            <td colspan="5" class="text-center px-6 py-6 text-gray-500 italic">
              No VPS Instances yet.
            </td>
          </tr>
        <% } %>
      </tbody>
    </table>
  </div>
</section>
<div id="createServerModal" class="fixed inset-0 bg-black bg-opacity-60 hidden flex items-center justify-center z-50">
  <div class="bg-[#1a1a1a] p-6 rounded-2xl shadow-2xl w-full max-w-md border border-[#2a2a2a]">
    <h2 class="text-xl font-semibold text-gray-200 mb-4">Create New VPS</h2>

    <form id="createServerForm" action="/admin/servers/create" method="POST" class="space-y-4">
      
      <div>
        <label class="block text-gray-300 mb-1">VPS Name</label>
        <input type="text" name="name" required 
          class="w-full p-2 rounded-lg bg-[#111] border border-[#333] text-white focus:outline-none focus:ring-2 focus:ring-blue-600">
      </div>

      <div>
        <label class="block text-gray-300 mb-1">GB</label>
        <input type="text" name="gb" required 
          class="w-full p-2 rounded-lg bg-[#111] border border-[#333] text-white focus:outline-none focus:ring-2 focus:ring-blue-600">
      </div>

      <div>
        <label class="block text-gray-300 mb-1">Cores</label>
        <input type="number" name="cores" required 
          class="w-full p-2 rounded-lg bg-[#111] border border-[#333] text-white focus:outline-none focus:ring-2 focus:ring-blue-600">
      </div>

      <!-- User Select -->
      <div>
        <label class="block text-gray-300 mb-1">Assign User</label>
        <select name="userId" required
          class="w-full p-2 rounded-lg bg-[#111] border border-[#333] text-white focus:outline-none focus:ring-2 focus:ring-blue-600">
          <% users.forEach(u => { %>
            <option value="<%= u.id %>"><%= u.username || u.email || u.id %></option>
          <% }) %>
        </select>
      </div>

      <!-- Node Select -->
      <div>
        <label class="block text-gray-300 mb-1">Assign Node</label>
        <select name="nodeId" required
          class="w-full p-2 rounded-lg bg-[#111] border border-[#333] text-white focus:outline-none focus:ring-2 focus:ring-blue-600">
          <% nodes.forEach(n => { %>
            <option value="<%= n.id %>"><%= n.name || n.address || n.id %></option>
          <% }) %>
        </select>
      </div>

      <div class="flex justify-end space-x-3 pt-4">
        <button type="button" onclick="closeCNModal()" 
          class="px-4 py-2 rounded-lg bg-gray-600 hover:bg-gray-500 text-white transition">
          Cancel
        </button>
        <button id="createServerBtn" type="submit" 
          class="px-4 py-2 rounded-lg bg-blue-600 hover:bg-blue-500 text-white transition shadow-md">
          Save
        </button>
      </div>
    </form>
  </div>
</div>

<script>
  document.getElementById("createServerForm").addEventListener("submit", function() {
    const btn = document.getElementById("createServerBtn");
    btn.disabled = true;
    btn.textContent = "Creating...";
    btn.classList.add("opacity-70", "cursor-not-allowed");
  });
</script>


    </main>
  </div>
  <%- include('../components/footer.ejs') %>
<script>
  function openCNModal() {
    document.getElementById("createServerModal").classList.remove("hidden");
  }
  function closeCNModal() {
    document.getElementById("createServerModal").classList.add("hidden");
  }
</script>
</body>
</html>
